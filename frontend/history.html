<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LegalMind AI | Activity History</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a3d7c;
            --primary-light: #2c5ba3;
            --secondary: #f8f9fa;
            --accent: #ff6b6b;
            --text: #333;
            --text-light: #6c757d;
            --border: #dee2e6;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 8px;
            --sidebar-width: 280px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f5f7fa; color: var(--text); line-height: 1.6; display: flex; }
        
        /* --- FIXED SIDEBAR STYLES --- */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            box-shadow: var(--shadow);
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            z-index: 20;
        }
        .logo { display: flex; align-items: center; gap: 12px; font-size: 22px; font-weight: 600; color: var(--primary); margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid var(--border); }
        .logo i { font-size: 28px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 15px; border-radius: var(--radius); color: var(--text); text-decoration: none; margin-bottom: 5px; transition: all 0.3s; }
        .nav-item:hover, .nav-item.active { background: var(--primary); color: white; }
        
        /* --- MAIN CONTENT ADJUSTMENTS --- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-left: var(--sidebar-width);
            min-height: 100vh;
        }
        .top-bar { background: white; padding: 15px 30px; box-shadow: var(--shadow); z-index: 10; }
        .content { padding: 30px; flex: 1; }
        .section-title { font-size: 1.8rem; color: var(--primary); margin-bottom: 20px; }
        
        /* --- HISTORY TIMELINE STYLES --- */
        .timeline { position: relative; max-width: 800px; margin: 0 auto; padding: 20px 0; }
        .timeline::before { content: ''; position: absolute; top: 0; left: 20px; height: 100%; width: 3px; background: var(--border); }
        .timeline-item { position: relative; margin-bottom: 30px; padding-left: 60px; }
        .timeline-item:last-child { margin-bottom: 0; }
        .timeline-icon { position: absolute; left: 0; top: 0; width: 40px; height: 40px; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 18px; border: 3px solid #f5f7fa; z-index: 1; }
        .timeline-icon.success { background-color: #27ae60; }
        .timeline-icon.error { background-color: #e74c3c; }
        .timeline-icon.info { background-color: #3498db; }
        .timeline-icon.delete { background-color: var(--text-light); }
        .timeline-content { background: white; padding: 20px; border-radius: var(--radius); box-shadow: var(--shadow); }
        .timeline-content p { margin: 0; font-size: 16px; }
        .timeline-content span { font-weight: 600; color: var(--primary); }
        .timeline-time { display: block; margin-top: 8px; font-size: 13px; color: var(--text-light); }
        .timeline-date-header { font-weight: 600; color: var(--text-light); margin-bottom: 20px; padding-left: 60px; position: relative; }
    </style>
</head>
<body>
    <aside class="sidebar">
        <div class="logo"><i class="fas fa-scale-balanced"></i><span>LegalMind AI</span></div>
        <a href="index.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
        </a>
        <a href="documents.html" class="nav-item">
            <i class="fas fa-file-contract"></i>
            <span>Documents</span>
        </a>
        <a href="#" class="nav-item active">
            <i class="fas fa-history"></i>
            <span>History</span>
        </a>
    </aside>

    <main class="main-content">
        <div class="top-bar"></div>
        <div class="content">
            <h1 class="section-title">Activity History</h1>
            <div class="timeline" id="timeline-container">
                <p>Loading history...</p>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const timelineContainer = document.getElementById('timeline-container');

            const eventDetails = {
                'UPLOAD_SUCCESS': { icon: 'fa-upload', color: 'info', text: 'Uploaded new document:' },
                'ANALYSIS_SUCCESS': { icon: 'fa-check', color: 'success', text: 'Successfully analyzed document:' },
                'ANALYSIS_FAIL': { icon: 'fa-times', color: 'error', text: 'Analysis failed for document:' },
                'TEXT_EXTRACT_FAIL': { icon: 'fa-exclamation-triangle', color: 'error', text: 'Could not read text from document:' },
                'DELETE_DOCUMENT': { icon: 'fa-trash', color: 'delete', text: 'Deleted document:' }
            };

            async function fetchHistory() {
                try {
                    // --- UPDATED: Points to your live Render backend URL ---
                    const response = await fetch('https://legalmind-ai-onrender.com/history');
                    
                    if (!response.ok) throw new Error('Failed to fetch history from the server.');
                    const events = await response.json();

                    timelineContainer.innerHTML = ''; 
                    if (events.length === 0) {
                        timelineContainer.innerHTML = '<p>No activity has been recorded yet.</p>';
                        return;
                    }

                    let lastDate = null;
                    events.forEach(event => {
                        const eventDateObj = new Date(event.timestamp.replace(/,/g, ''));
                        const eventDate = eventDateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                        const eventYear = eventDateObj.getFullYear();
                        const eventTime = eventDateObj.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });

                        if (eventDate !== lastDate) {
                            const dateHeader = `<div class="timeline-date-header">${eventDate}, ${eventYear}</div>`;
                            timelineContainer.insertAdjacentHTML('beforeend', dateHeader);
                            lastDate = eventDate;
                        }
                        
                        const details = eventDetails[event.event_type] || { icon: 'fa-question-circle', color: 'info', text: 'Unknown event:' };

                        const itemHtml = `
                            <div class="timeline-item">
                                <div class="timeline-icon ${details.color}">
                                    <i class="fas ${details.icon}"></i>
                                </div>
                                <div class="timeline-content">
                                    <p>${details.text} <span>${event.document_name}</span></p>
                                    <small class="timeline-time">${eventTime}</small>
                                </div>
                            </div>
                        `;
                        timelineContainer.insertAdjacentHTML('beforeend', itemHtml);
                    });
                } catch (error) {
                    console.error("Error fetching history:", error);
                    timelineContainer.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                }
            }

            fetchHistory();
        });
    </script>
</body>
</html>
